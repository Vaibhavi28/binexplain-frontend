<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BinExplain v3.0 - Enhanced CTF Binary Analyzer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script>
        const { useState } = React;
        const BACKEND_URL = 'https://binexplain-backend.onrender.com';
        
        function BinExplain() {
            const [activeTab, setActiveTab] = useState('standard');
            const [file, setFile] = useState(null);
            const [sourceFile, setSourceFile] = useState(null);
            const [zipPassword, setZipPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [results, setResults] = useState(null);
            const [error, setError] = useState(null);

            const handleFileChange = (e) => {
                setFile(e.target.files[0]);
                setError(null);
                setResults(null);
            };

            const handleSourceChange = (e) => {
                setSourceFile(e.target.files[0]);
                setError(null);
            };

            const analyzeStandard = async () => {
                if (!file) {
                    setError('Please select a file');
                    return;
                }

                setLoading(true);
                setError(null);
                setResults(null);

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch(`${BACKEND_URL}/analyze`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }

                    const data = await response.json();
                    setResults({ type: 'standard', data });
                } catch (err) {
                    setError(`Analysis failed: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const analyzeWithAddresses = async () => {
                if (!file) {
                    setError('Please select a binary file');
                    return;
                }

                setLoading(true);
                setError(null);
                setResults(null);

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch(`${BACKEND_URL}/analyze-with-addresses`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }

                    const data = await response.json();
                    setResults({ type: 'addresses', data });
                } catch (err) {
                    setError(`Analysis failed: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const analyzeWithSource = async () => {
                if (!file || !sourceFile) {
                    setError('Please select both binary and source files');
                    return;
                }

                setLoading(true);
                setError(null);
                setResults(null);

                const formData = new FormData();
                formData.append('binary', file);
                formData.append('source', sourceFile);

                try {
                    const response = await fetch(`${BACKEND_URL}/analyze-with-source`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }

                    const data = await response.json();
                    setResults({ type: 'source_match', data });
                } catch (err) {
                    setError(`Analysis failed: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const analyzeZip = async () => {
                if (!file) {
                    setError('Please select a ZIP file');
                    return;
                }

                setLoading(true);
                setError(null);
                setResults(null);

                const formData = new FormData();
                formData.append('file', file);
                if (zipPassword) {
                    formData.append('password', zipPassword);
                }

                try {
                    const response = await fetch(`${BACKEND_URL}/analyze-zip`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error(`Server error: ${response.status}`);
                    }

                    const data = await response.json();
                    setResults({ type: 'zip', data });
                } catch (err) {
                    setError(`Analysis failed: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', 
                { className: 'min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white p-8' },
                React.createElement('div', { className: 'max-w-7xl mx-auto' },
                    
                    React.createElement('div', { className: 'text-center mb-12' },
                        React.createElement('h1', { className: 'text-6xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent' }, 'BinExplain v3.0'),
                        React.createElement('p', { className: 'text-xl text-gray-300' }, 'Enhanced CTF Binary Analyzer with Memory Addresses, Source Matching & ZIP Support'),
                        React.createElement('p', { className: 'text-sm text-gray-400 mt-2' }, 'ðŸ”’ Secure â€¢ ðŸš€ Fast â€¢ ðŸŽ¯ Beginner-friendly')
                    ),

                    React.createElement('div', { className: 'bg-gray-800 rounded-lg p-2 mb-8 flex gap-2' },
                        ['standard', 'addresses', 'source_match', 'zip'].map(tab =>
                            React.createElement('button', {
                                key: tab,
                                onClick: () => setActiveTab(tab),
                                className: `flex-1 py-3 px-4 rounded-lg font-semibold transition-all ${
                                    activeTab === tab 
                                    ? 'bg-blue-600 text-white' 
                                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                }`
                            }, 
                                tab === 'standard' ? 'ðŸ“Š Standard Analysis' :
                                tab === 'addresses' ? 'ðŸŽ¯ Memory Addresses' :
                                tab === 'source_match' ? 'ðŸ”— Source Matching' :
                                'ðŸ“¦ ZIP Analysis'
                            )
                        )
                    ),

                    activeTab === 'standard' && React.createElement('div', { className: 'bg-gray-800 rounded-lg p-8 mb-8 border border-gray-700' },
                        React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'ðŸ“Š Standard Binary Analysis'),
                        React.createElement('p', { className: 'text-gray-400 mb-6' }, 'Upload a binary to extract strings, flags, functions, and security features'),
                        
                        React.createElement('label', { className: 'flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors bg-gray-900 mb-6' },
                            React.createElement('div', { className: 'flex flex-col items-center' },
                                React.createElement('p', { className: 'mb-2 text-sm text-gray-400' }, 
                                    React.createElement('span', { className: 'font-semibold' }, 'Click to upload'), ' or drag and drop'
                                ),
                                React.createElement('p', { className: 'text-xs text-gray-500' }, 'Binary files (.bin, .elf, .exe) â€¢ Max 5MB'),
                                file && React.createElement('p', { className: 'mt-2 text-sm text-blue-400 font-medium' }, file.name)
                            ),
                            React.createElement('input', { type: 'file', className: 'hidden', onChange: handleFileChange })
                        ),
                        
                        React.createElement('button', {
                            onClick: analyzeStandard,
                            disabled: !file || loading,
                            className: 'w-full px-8 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors'
                        }, loading ? 'Analyzing...' : 'Analyze Binary')
                    ),

                    activeTab === 'addresses' && React.createElement('div', { className: 'bg-gray-800 rounded-lg p-8 mb-8 border border-gray-700' },
                        React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'ðŸŽ¯ Memory Address Analysis'),
                        React.createElement('p', { className: 'text-gray-400 mb-6' }, 'Extract strings with their memory addresses and sections'),
                        
                        React.createElement('label', { className: 'flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-purple-500 transition-colors bg-gray-900 mb-6' },
                            React.createElement('div', { className: 'flex flex-col items-center' },
                                React.createElement('p', { className: 'mb-2 text-sm text-gray-400' }, 
                                    React.createElement('span', { className: 'font-semibold' }, 'Upload binary file')
                                ),
                                React.createElement('p', { className: 'text-xs text-gray-500' }, 'Shows memory addresses for each string'),
                                file && React.createElement('p', { className: 'mt-2 text-sm text-purple-400 font-medium' }, file.name)
                            ),
                            React.createElement('input', { type: 'file', className: 'hidden', onChange: handleFileChange })
                        ),
                        
                        React.createElement('button', {
                            onClick: analyzeWithAddresses,
                            disabled: !file || loading,
                            className: 'w-full px-8 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors'
                        }, loading ? 'Analyzing...' : 'Extract Memory Addresses')
                    ),

                    activeTab === 'source_match' && React.createElement('div', { className: 'bg-gray-800 rounded-lg p-8 mb-8 border border-gray-700' },
                        React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'ðŸ”— Source Code Matching'),
                        React.createElement('p', { className: 'text-gray-400 mb-6' }, 'Upload binary + source code to find connections'),
                        
                        React.createElement('div', { className: 'grid grid-cols-2 gap-4 mb-6' },
                            React.createElement('label', { className: 'flex flex-col items-center justify-center h-40 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-green-500 transition-colors bg-gray-900' },
                                React.createElement('div', { className: 'flex flex-col items-center' },
                                    React.createElement('p', { className: 'text-sm text-gray-400' }, 'ðŸ“ Binary File'),
                                    file && React.createElement('p', { className: 'mt-2 text-xs text-green-400' }, file.name)
                                ),
                                React.createElement('input', { type: 'file', className: 'hidden', onChange: handleFileChange })
                            ),
                            React.createElement('label', { className: 'flex flex-col items-center justify-center h-40 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-green-500 transition-colors bg-gray-900' },
                                React.createElement('div', { className: 'flex flex-col items-center' },
                                    React.createElement('p', { className: 'text-sm text-gray-400' }, 'ðŸ“„ Source Code'),
                                    sourceFile && React.createElement('p', { className: 'mt-2 text-xs text-green-400' }, sourceFile.name)
                                ),
                                React.createElement('input', { type: 'file', className: 'hidden', onChange: handleSourceChange, accept: '.c,.cpp,.cc,.h,.hpp,.txt' })
                            )
                        ),
                        
                        React.createElement('button', {
                            onClick: analyzeWithSource,
                            disabled: !file || !sourceFile || loading,
                            className: 'w-full px-8 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors'
                        }, loading ? 'Matching...' : 'Match Binary with Source')
                    ),

                    activeTab === 'zip' && React.createElement('div', { className: 'bg-gray-800 rounded-lg p-8 mb-8 border border-gray-700' },
                        React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'ðŸ“¦ ZIP File Analysis'),
                        React.createElement('p', { className: 'text-gray-400 mb-6' }, 'Upload password-protected ZIP (max 500KB, up to 20 files)'),
                        
                        React.createElement('label', { className: 'flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-yellow-500 transition-colors bg-gray-900 mb-4' },
                            React.createElement('div', { className: 'flex flex-col items-center' },
                                React.createElement('p', { className: 'mb-2 text-sm text-gray-400' }, 
                                    React.createElement('span', { className: 'font-semibold' }, 'Upload ZIP file')
                                ),
                                React.createElement('p', { className: 'text-xs text-gray-500' }, 'Max 500KB â€¢ Standard encryption only'),
                                file && React.createElement('p', { className: 'mt-2 text-sm text-yellow-400 font-medium' }, file.name)
                            ),
                            React.createElement('input', { type: 'file', className: 'hidden', onChange: handleFileChange, accept: '.zip' })
                        ),
                        
                        React.createElement('input', {
                            type: 'password',
                            placeholder: 'ZIP password (optional)',
                            value: zipPassword,
                            onChange: (e) => setZipPassword(e.target.value),
                            className: 'w-full px-4 py-3 bg-gray-900 border border-gray-600 rounded-lg text-white mb-6 focus:outline-none focus:border-yellow-500'
                        }),
                        
                        React.createElement('button', {
                            onClick: analyzeZip,
                            disabled: !file || loading,
                            className: 'w-full px-8 py-3 bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors'
                        }, loading ? 'Extracting...' : 'Analyze ZIP Contents')
                    ),

                    error && React.createElement('div', { className: 'bg-red-900 border border-red-700 rounded-lg p-4 mb-8' },
                        React.createElement('p', { className: 'font-semibold text-red-200' }, 'âŒ Error'),
                        React.createElement('p', { className: 'text-sm text-red-300' }, error)
                    ),

                    results && results.type === 'standard' && React.createElement('div', { className: 'space-y-6' },
                        React.createElement('div', { className: 'bg-gray-800 rounded-lg p-6 border border-gray-700' },
                            React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'Binary Information'),
                            React.createElement('div', { className: 'grid grid-cols-2 gap-4 text-sm' },
                                React.createElement('div', null,
                                    React.createElement('span', { className: 'text-gray-400' }, 'File Type:'),
                                    React.createElement('p', { className: 'text-white font-mono' }, results.data.binary_info?.file_type || 'Unknown')
                                ),
                                React.createElement('div', null,
                                    React.createElement('span', { className: 'text-gray-400' }, 'Architecture:'),
                                    React.createElement('p', { className: 'text-white font-mono' }, results.data.binary_info?.architecture || 'Unknown')
                                )
                            )
                        ),
                        
                        results.data.flags && results.data.flags.length > 0 && React.createElement('div', { className: 'bg-gray-800 rounded-lg p-6 border border-green-700' },
                            React.createElement('h2', { className: 'text-2xl font-bold mb-4 text-green-400' }, `ðŸš© Detected Flags (${results.data.flags.length})`),
                            React.createElement('div', { className: 'space-y-2' },
                                results.data.flags.slice(0, 10).map((flag, idx) =>
                                    React.createElement('div', { key: idx, className: 'bg-gray-900 rounded p-3 border border-green-600' },
                                        React.createElement('code', { className: 'text-green-300 font-mono break-all' }, flag.value),
                                        React.createElement('div', { className: 'text-xs text-gray-400 mt-1' }, `Type: ${flag.type} | Score: ${flag.score}`)
                                    )
                                )
                            )
                        )
                    ),

                    results && results.type === 'addresses' && React.createElement('div', { className: 'bg-gray-800 rounded-lg p-6 border border-purple-700' },
                        React.createElement('h2', { className: 'text-2xl font-bold mb-4 text-purple-400' }, `ðŸŽ¯ Memory Addresses (${results.data.memory_addresses?.length || 0})`),
                        React.createElement('div', { className: 'bg-gray-900 rounded p-4 max-h-96 overflow-y-auto' },
                            React.createElement('div', { className: 'space-y-2' },
                                results.data.memory_addresses?.slice(0, 50).map((item, idx) =>
                                    React.createElement('div', { key: idx, className: 'flex gap-4 text-sm border-b border-gray-700 pb-2' },
                                        React.createElement('span', { className: 'text-purple-400 font-mono w-24' }, item.address),
                                        React.createElement('span', { className: 'text-gray-500 w-16' }, item.section),
                                        React.createElement('span', { className: 'text-gray-300 flex-1' }, item.string)
                                    )
                                )
                            )
                        )
                    ),

                    results && results.type === 'source_match' && React.createElement('div', { className: 'space-y-6' },
                        results.data.matches?.string_matches && results.data.matches.string_matches.length > 0 && 
                        React.createElement('div', { className: 'bg-gray-800 rounded-lg p-6 border border-green-700' },
                            React.createElement('h2', { className: 'text-2xl font-bold mb-4 text-green-400' }, `âœ… String Matches (${results.data.matches.string_matches.length})`),
                            React.createElement('div', { className: 'space-y-2 max-h-64 overflow-y-auto' },
                                results.data.matches.string_matches.slice(0, 20).map((match, idx) =>
                                    React.createElement('div', { key: idx, className: 'bg-gray-900 rounded p-2 text-sm' },
                                        React.createElement('code', { className: 'text-green-300' }, match.value)
                                    )
                                )
                            )
                        ),
                        
                        results.data.matches?.function_matches && results.data.matches.function_matches.length > 0 &&
                        React.createElement('div', { className: 'bg-gray-800 rounded-lg p-6 border border-blue-700' },
                            React.createElement('h2', { className: 'text-2xl font-bold mb-4 text-blue-400' }, `âš™ï¸ Function Matches (${results.data.matches.function_matches.length})`),
                            React.createElement('div', { className: 'space-y-2 max-h-64 overflow-y-auto' },
                                results.data.matches.function_matches.slice(0, 20).map((match, idx) =>
                                    React.createElement('div', { key: idx, className: 'bg-gray-900 rounded p-2 text-sm' },
                                        React.createElement('code', { className: 'text-blue-300' }, match.name)
                                    )
                                )
                            )
                        ),

                        results.data.matches?.hints && results.data.matches.hints.length > 0 &&
                        React.createElement('div', { className: 'bg-gray-800 rounded-lg p-6 border border-yellow-700' },
                            React.createElement('h2', { className: 'text-2xl font-bold mb-4 text-yellow-400' }, 'ðŸ’¡ Matching Hints'),
                            React.createElement('ul', { className: 'space-y-2' },
                                results.data.matches.hints.map((hint, idx) =>
                                    React.createElement('li', { key: idx, className: 'text-gray-300' }, `â€¢ ${hint}`)
                                )
                            )
                        )
                    ),

                    results && results.type === 'zip' && React.createElement('div', { className: 'bg-gray-800 rounded-lg p-6 border border-yellow-700' },
                        React.createElement('h2', { className: 'text-2xl font-bold mb-4 text-yellow-400' }, `ðŸ“¦ ZIP Contents (${results.data.count} files)`),
                        React.createElement('div', { className: 'space-y-4' },
                            Object.entries(results.data.files || {}).map(([filename, fileData]) =>
                                React.createElement('div', { key: filename, className: 'bg-gray-900 rounded p-4 border border-yellow-600' },
                                    React.createElement('h3', { className: 'text-lg font-semibold text-yellow-300 mb-2' }, filename),
                                    React.createElement('p', { className: 'text-sm text-gray-400' }, `Type: ${fileData.type}`),
                                    fileData.analysis && React.createElement('p', { className: 'text-sm text-gray-400 mt-1' }, 
                                        `Strings: ${fileData.analysis.strings?.length || 0}, Functions: ${fileData.analysis.functions?.length || 0}`
                                    )
                                )
                            )
                        )
                    ),

                    React.createElement('div', { className: 'mt-12 text-center text-sm text-gray-500' },
                        React.createElement('p', null, 'ðŸ”’ Secure Analysis â€¢ ðŸ“Š No Code Execution â€¢ ðŸŽ“ Educational Tool'),
                        React.createElement('p', { className: 'mt-2' }, 'v3.0 - Memory Addresses â€¢ Source Matching â€¢ ZIP Support')
                    )
                )
            );
        }

        ReactDOM.render(React.createElement(BinExplain), document.getElementById('root'));
    </script>
</body>
</html>